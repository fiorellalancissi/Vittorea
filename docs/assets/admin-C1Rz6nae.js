import{E as gt,i as m,g as v}from"./index-CCxDqwPe.js";const yt=gt("admin",()=>{const d=m([]);function B(t){const n={id:d.value.length>0?Math.max(...d.value.map(i=>i.id))+1:1,nombre:t.nombre,telefono:t.telefono,email:t.email||"",fecha_ultima_compra:t.fecha_ultima_compra||new Date().toISOString(),notas_internas:t.notas_internas||"",tags:t.tags||[]};return d.value.push(n),n}function F(t,e){const n=d.value.findIndex(i=>i.id===t);n>-1&&(d.value[n]={...d.value[n],...e})}function D(t){const e=d.value.findIndex(n=>n.id===t);e>-1&&d.value.splice(e,1)}function w(t){return d.value.find(e=>e.id===t)}function R(t){let e=d.value.find(n=>n.telefono===t.telefono);return e||(e=B(t)),e}const f=m([]);function L(t){const e=f.value.length>0?Math.max(...f.value.map(n=>n.id))+1:1;return f.value.push({id:e,name:t.name,active:t.active!==!1}),e}function K(t,e){const n=f.value.findIndex(i=>i.id===t);n>-1&&(f.value[n]={...f.value[n],...e})}function U(t){const e=f.value.findIndex(n=>n.id===t);e>-1&&f.value.splice(e,1)}function C(t){return f.value.find(e=>e.id===t)}function Y(t){const e=f.value.find(n=>n.name.toLowerCase()===t.toLowerCase());return e?e.id:L({name:t})}const g=m([]);function W(t){const e=g.value.length>0?Math.max(...g.value.map(n=>n.id))+1:1;return g.value.push({id:e,name:t.name,active:t.active!==!1}),e}function _(t){return g.value.find(e=>e.id===t)}function z(t){if(!t)return null;const e=g.value.find(n=>n.name.toLowerCase()===t.toLowerCase());return e?e.id:W({name:t})}const P=m([]);function E(t){const e=P.value.length>0?Math.max(...P.value.map(n=>n.id))+1:1;return P.value.push({id:e,value:t.value,active:t.active!==!1}),e}function q(t){return P.value.find(e=>e.id===t)}function G(t){if(!t)return null;const e=P.value.find(n=>n.value===t);return e?e.id:E({value:t})}const u=m([]),V=v(()=>u.value.map(t=>{var e,n,i;return{...t,brand:((e=C(t.brandId))==null?void 0:e.name)||"Sin marca",line:t.lineId?(n=_(t.lineId))==null?void 0:n.name:"",ml:t.mlId?(i=q(t.mlId))==null?void 0:i.value:"",price:t.salePrice}})),H=v(()=>V.value.filter(t=>t.active&&t.stock>0));function O(t){return Math.round(t*1.4)}function J(t){const e=u.value.length>0?Math.max(...u.value.map(c=>c.id))+1:1,n=t.salePrice||O(t.costPrice),i={...t,id:e,costPrice:t.costPrice,salePrice:n,stock:t.stock||0,active:t.active!==!1};return u.value.push(i),i}function Q(t,e){const n=u.value.findIndex(i=>i.id===t);n>-1&&(e.costPrice&&!e.salePrice&&(e.salePrice=O(e.costPrice)),u.value[n]={...u.value[n],...e})}function X(t){const e=u.value.findIndex(n=>n.id===t);e>-1&&u.value.splice(e,1)}function y(t){var n,i,c;const e=u.value.find(a=>a.id===Number(t));return e?{...e,brand:((n=C(e.brandId))==null?void 0:n.name)||"Sin marca",line:e.lineId?(i=_(e.lineId))==null?void 0:i.name:"",ml:e.mlId?(c=q(e.mlId))==null?void 0:c.value:"",price:e.salePrice}:null}function S(t,e){const n=u.value.find(i=>i.id===t);n&&(n.stock=Math.max(0,n.stock+e))}const r=m([]),Z=v(()=>r.value.map(t=>({...t,product:y(t.productId)})).sort((t,e)=>new Date(e.date)-new Date(t.date)));function $(t){const e=r.value.length>0?Math.max(...r.value.map(i=>i.id))+1:1,n={...t,id:e,date:t.date||new Date().toISOString(),status:t.status||"completado",orderId:t.orderId||null};if(r.value.push(n),n.status!=="pendiente"){const i=t.type==="ingreso"?t.quantity:-t.quantity;S(t.productId,i)}return e}function tt(t){const e=r.value.find(n=>n.id===t);if(e){if(e.status!=="pendiente"){const i=e.type==="ingreso"?-e.quantity:e.quantity;S(e.productId,i)}const n=r.value.findIndex(i=>i.id===t);r.value.splice(n,1)}}function et(t){const e=r.value.find(n=>n.id===t);if(e&&e.status==="pendiente"){e.status="confirmado";const n=e.type==="ingreso"?e.quantity:-e.quantity;S(e.productId,n),e.orderId&&M(e.orderId,{estado:"confirmado"})}}function nt(t){const e=r.value.find(n=>n.id===t);e&&e.status==="confirmado"&&(e.status="entregado",e.orderId&&M(e.orderId,{estado:"entregado"}))}const l=m([]);function it(t){const e=R({nombre:t.clienteNombre,telefono:t.clienteTelefono,email:t.clienteEmail||""}),n=l.value.length>0?Math.max(...l.value.map(a=>a.id))+1:1,i=y(t.productId),c={id:n,clientId:e.id,productId:t.productId,quantity:t.quantity,unitPrice:(i==null?void 0:i.salePrice)||t.unitPrice,costPrice:(i==null?void 0:i.costPrice)||t.costPrice,date:t.date||new Date().toISOString(),estado:t.estado||"pendiente",notas:t.notas||""};return l.value.push(c),F(e.id,{fecha_ultima_compra:c.date}),$({productId:t.productId,type:"egreso",quantity:t.quantity,reason:"Venta",notes:`Pedido #${n} - ${e.nombre}`,status:"pendiente",orderId:n}),{order:c,client:e}}function M(t,e){const n=l.value.findIndex(i=>i.id===t);n>-1&&(l.value[n]={...l.value[n],...e})}function N(t){return l.value.find(e=>e.id===t)}const T=v(()=>l.value.map(t=>{const e=y(t.productId),n=w(t.clientId);return{...t,product:e,client:n,total:t.unitPrice*t.quantity,profit:(t.unitPrice-t.costPrice)*t.quantity}}).sort((t,e)=>new Date(e.date)-new Date(t.date)));function at(t){return T.value.filter(e=>e.clientId===t)}const s=m([]);function ot(t){const n={id:s.value.length>0?Math.max(...s.value.map(i=>i.id))+1:1,clientId:t.clientId,orderId:t.orderId,productId:t.productId,nivel_satisfaccion:t.nivel_satisfaccion,duracion_percibida:t.duracion_percibida,intensidad_percibida:t.intensidad_percibida,volveria_a_comprar:t.volveria_a_comprar,comentario_libre:t.comentario_libre||"",fecha:t.fecha||new Date().toISOString()};return s.value.push(n),n}function ct(t,e){const n=s.value.findIndex(i=>i.id===t);n>-1&&(s.value[n]={...s.value[n],...e})}function ut(t){const e=s.value.findIndex(n=>n.id===t);e>-1&&s.value.splice(e,1)}const k=v(()=>s.value.map(t=>({...t,client:w(t.clientId),order:N(t.orderId),product:y(t.productId)})).sort((t,e)=>new Date(e.fecha)-new Date(t.fecha)));function lt(t){return k.value.filter(e=>e.clientId===t)}function st(t){return k.value.filter(e=>e.productId===t)}const x=m(30),j=v(()=>{const t=u.value.length,e=u.value.reduce((o,p)=>o+p.stock,0),n=u.value.filter(o=>o.stock<=1&&o.stock>0),i=u.value.filter(o=>o.stock===0),c=u.value.reduce((o,p)=>o+p.costPrice*p.stock,0),a=u.value.reduce((o,p)=>o+p.salePrice*p.stock,0),b=d.value.length,I=[...new Set(l.value.map(o=>o.clientId))].length,h=d.value.filter(o=>l.value.filter(ht=>ht.clientId===o.id).length>1).length,pt=r.value.filter(o=>o.type==="egreso"&&o.status==="pendiente").length,It=r.value.filter(o=>o.type==="egreso"&&o.status==="confirmado").length;return{totalProducts:t,totalStock:e,lowStockProducts:n.length,outOfStockProducts:i.length,totalCostValue:c,totalSaleValue:a,totalValue:a,totalClients:b,clientsWithOrders:I,repeatClients:h,pendingTransfers:pt,pendingDeliveries:It}}),A=v(()=>{const t={};return l.value.forEach(e=>{const n=new Date(e.date),i=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`;t[i]||(t[i]={month:i,totalSales:0,totalCost:0,totalProfit:0,unitsSold:0,transactions:0});const c=e.unitPrice*e.quantity,a=e.costPrice*e.quantity;t[i].totalSales+=c,t[i].totalCost+=a,t[i].totalProfit+=c-a,t[i].unitsSold+=e.quantity,t[i].transactions++}),Object.values(t).sort((e,n)=>e.month.localeCompare(n.month))}),dt=v(()=>{const t={};l.value.forEach(n=>{if(!t[n.productId]){const i=y(n.productId);t[n.productId]={productId:n.productId,productName:(i==null?void 0:i.name)||"Producto eliminado",productImage:i==null?void 0:i.image,unitsSold:0,totalRevenue:0,totalProfit:0}}t[n.productId].unitsSold+=n.quantity,t[n.productId].totalRevenue+=n.unitPrice*n.quantity,t[n.productId].totalProfit+=(n.unitPrice-n.costPrice)*n.quantity});const e=Object.values(t).sort((n,i)=>i.unitsSold-n.unitsSold);return{all:e,top:e[0]||null,bottom:e[e.length-1]||null}}),rt=v(()=>{const t=l.value.reduce((n,i)=>n+i.quantity,0),e=j.value.totalStock;return e===0?0:(t/e).toFixed(2)}),ft=v(()=>{const t=new Date().toISOString().slice(0,7),e=A.value.find(I=>I.month===t),n=l.value.reduce((I,h)=>I+h.unitPrice*h.quantity,0),i=l.value.reduce((I,h)=>I+h.costPrice*h.quantity,0),c=n-i,a=(e==null?void 0:e.totalProfit)||0,b=Math.round(a*(x.value/100));return{totalRevenue:n,totalCost:i,totalProfit:c,monthlyRevenue:(e==null?void 0:e.totalSales)||0,monthlyProfit:a,monthlyReinvestment:b,reinvestmentPercent:x.value,profitMargin:n>0?(c/n*100).toFixed(1):0}}),vt=v(()=>{const t=s.value.length,e=s.value.filter(a=>a.nivel_satisfaccion==="positivo").length,n=s.value.filter(a=>a.nivel_satisfaccion==="neutro").length,i=s.value.filter(a=>a.nivel_satisfaccion==="negativo").length,c=s.value.filter(a=>a.volveria_a_comprar).length;return{total:t,positive:e,neutral:n,negative:i,wouldRepurchase:c,satisfactionRate:t>0?(e/t*100).toFixed(1):0,repurchaseRate:t>0?(c/t*100).toFixed(1):0}});function mt(t){x.value=Math.max(0,Math.min(100,t))}return{clients:d,addClient:B,updateClient:F,deleteClient:D,getClientById:w,findOrCreateClient:R,brands:f,addBrand:L,updateBrand:K,deleteBrand:U,getBrandById:C,findOrCreateBrand:Y,lines:g,addLine:W,getLineById:_,findOrCreateLine:z,mlOptions:P,addMlOption:E,getMlById:q,findOrCreateMl:G,products:u,productsWithBrand:V,catalogProducts:H,calculateSalePrice:O,addProduct:J,updateProduct:Q,deleteProduct:X,getProductById:y,updateStock:S,movements:r,movementsWithProduct:Z,addMovement:$,deleteMovement:tt,confirmTransfer:et,confirmDelivery:nt,orders:l,ordersWithDetails:T,addOrder:it,updateOrder:M,getOrderById:N,getOrdersByClient:at,feedbacks:s,feedbacksWithDetails:k,addFeedback:ot,updateFeedback:ct,deleteFeedback:ut,getFeedbacksByClient:lt,getFeedbacksByProduct:st,stats:j,salesByMonth:A,productSalesRanking:dt,inventoryRotation:rt,financialMetrics:ft,clientSatisfactionMetrics:vt,reinvestmentPercent:x,setReinvestmentPercent:mt}});export{yt as u};
