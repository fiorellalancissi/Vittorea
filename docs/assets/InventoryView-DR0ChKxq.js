import{_ as N,i as V,g as z,c as a,o as n,b as e,k as p,a as h,q as S,v as A,F as $,r as x,y as W,t as r,n as v,z as Q,j as G,f as D,p as j,e as L,A as U,T as H}from"./index-BRhBE-Hd.js";import{u as F}from"./admin-CNJvRZFe.js";import{_}from"./Icon-BQh9hsRm.js";const J={class:"product-tree-selector"},K={class:"selector-header"},X={class:"search-box"},Y={key:0,class:"selection-actions"},Z={class:"tree-container"},ee=["onClick"],te={class:"count"},se={key:0,class:"brand-content"},oe={class:"line-header"},ne={class:"count"},ae={class:"products-list"},le=["checked","onChange"],re=["src","alt"],ie={class:"product-info"},de={class:"product-name"},ue={key:0,class:"product-ml"},ce={key:0,class:"empty-state"},pe={key:0,class:"selection-summary"},me={__name:"ProductTreeSelector",props:{modelValue:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(y,{emit:B}){const f=y,k=B,E=F(),b=V(""),m=V({}),g=z(()=>{const d=E.productsWithBrand,l={};return d.forEach(i=>{const o=i.brand||"Sin marca",s=i.line||"Sin línea";l[o]||(l[o]={},m.value[o]=!0),l[o][s]||(l[o][s]=[]),l[o][s].push(i)}),l}),c=z(()=>{if(!b.value)return g.value;const d=b.value.toLowerCase(),l={};return Object.entries(g.value).forEach(([i,o])=>{const s=i.toLowerCase().includes(d);Object.entries(o).forEach(([t,u])=>{const I=t.toLowerCase().includes(d),M=u.filter(q=>q.name.toLowerCase().includes(d)||s||I);M.length>0&&(l[i]||(l[i]={}),l[i][t]=M)})}),l});function T(d){m.value[d]=!m.value[d]}function C(d){return f.modelValue.includes(d)}function w(d){const l=[...f.modelValue],i=l.indexOf(d);if(f.multiple)i>-1?l.splice(i,1):l.push(d);else{k("update:modelValue",i>-1?[]:[d]);return}k("update:modelValue",l)}function P(){const d=Object.values(c.value).flatMap(l=>Object.values(l)).flatMap(l=>l.map(i=>i.id));k("update:modelValue",d)}function O(){k("update:modelValue",[])}return(d,l)=>(n(),a("div",J,[e("div",K,[e("div",X,[h(_,{name:"tag",size:16}),S(e("input",{type:"text","onUpdate:modelValue":l[0]||(l[0]=i=>b.value=i),class:"search-input",placeholder:"Buscar por marca, línea o modelo..."},null,512),[[A,b.value]])]),y.multiple?(n(),a("div",Y,[e("button",{type:"button",class:"btn-link",onClick:P}," Todos "),e("button",{type:"button",class:"btn-link",onClick:O}," Ninguno ")])):p("",!0)]),e("div",Z,[(n(!0),a($,null,x(c.value,(i,o)=>(n(),a("div",{key:o,class:"brand-node"},[e("div",{class:"brand-header",onClick:s=>T(o)},[h(_,{name:(m.value[o],"arrow-right"),size:14,style:W({transform:m.value[o]?"rotate(90deg)":"rotate(0deg)",transition:"transform 0.2s"})},null,8,["name","style"]),e("strong",null,r(o),1),e("span",te,"("+r(Object.values(i).flat().length)+")",1)],8,ee),m.value[o]?(n(),a("div",se,[(n(!0),a($,null,x(i,(s,t)=>(n(),a("div",{key:t,class:"line-node"},[e("div",oe,[h(_,{name:"tag",size:12}),e("em",null,r(t),1),e("span",ne,"("+r(s.length)+")",1)]),e("div",ae,[(n(!0),a($,null,x(s,u=>(n(),a("label",{key:u.id,class:v(["product-item",{selected:C(u.id)}])},[e("input",{type:"checkbox",checked:C(u.id),onChange:I=>w(u.id),class:"product-checkbox"},null,40,le),u.image?(n(),a("img",{key:0,src:u.image,alt:u.name,class:"product-thumb"},null,8,re)):p("",!0),e("div",ie,[e("span",de,r(u.name),1),u.ml?(n(),a("span",ue,r(u.ml),1)):p("",!0),e("span",{class:v(["product-stock",{"stock-low":u.stock<=1,"stock-empty":u.stock===0}])}," Stock: "+r(u.stock),3)])],2))),128))])]))),128))])):p("",!0)]))),128)),Object.keys(c.value).length===0?(n(),a("div",ce,[h(_,{name:"alert",size:32}),l[1]||(l[1]=e("p",null,"No se encontraron productos",-1))])):p("",!0)]),y.multiple&&y.modelValue.length>0?(n(),a("div",pe,r(y.modelValue.length)+" producto"+r(y.modelValue.length!==1?"s":"")+" seleccionado"+r(y.modelValue.length!==1?"s":""),1)):p("",!0)]))}},ge=N(me,[["__scopeId","data-v-c5b710b0"]]),fe={class:"inventory-page"},ve={class:"page-header"},ye={class:"header-actions"},be={class:"table-container"},he={class:"data-table"},_e={key:0},ke={class:"cell-date"},Ce={class:"product-cell"},Ve=["src","alt"],$e={class:"product-info"},xe={class:"product-name"},we={class:"product-brand"},Ie={class:"cell-quantity"},Me={class:"cell-notes"},Se={class:"cell-actions"},Te={class:"action-buttons"},qe=["onClick"],ze=["onClick"],Be=["onClick"],Ee={class:"modal"},Pe={class:"modal-header"},Oe={class:"modal-title"},je={class:"form-group"},Ae=["value"],Re={key:2,class:"form-error"},De={key:3,class:"form-error"},Le={class:"form-group"},Ue={key:0,class:"form-error"},Ne={class:"form-group"},Fe=["value"],We={key:0,class:"form-error"},Qe={class:"form-group"},Ge={class:"modal-actions"},He={__name:"InventoryView",setup(y){const B=G(),f=F(),k=z(()=>f.movementsWithProduct),E=z(()=>f.productsWithBrand),b=V(!1),m=V("ingreso"),g=V({productId:"",productIds:[],quantity:1,reason:"",notes:""}),c=V({}),T={ingreso:["Compra de stock","Devolución de cliente","Ajuste de inventario","Otro"],egreso:["Venta","Producto dañado","Muestra/Regalo","Ajuste de inventario","Otro"]};function C(o){m.value=o,g.value={productId:"",productIds:[],quantity:1,reason:T[o][0],notes:""},c.value={},b.value=!0}function w(){b.value=!1}function P(o){confirm("¿Eliminar este movimiento? Se revertirá el cambio de stock.")&&f.deleteMovement(o)}function O(o){confirm("¿Confirmar la transferencia? Esto descontará el stock.")&&f.confirmTransfer(o)}function d(o){confirm("¿Confirmar la entrega? El pedido se marcará como completado.")&&f.confirmDelivery(o)}function l(o){const s={pendiente:{text:"Pendiente",class:"badge-warning"},confirmado:{text:"Confirmado",class:"badge-info"},entregado:{text:"Entregado",class:"badge-success"},completado:{text:"Completado",class:"badge-success"}};return s[o]||s.completado}function i(o){return new Date(o).toLocaleDateString("es-AR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}return Q(()=>{const o=B.query.action;(o==="ingreso"||o==="egreso")&&C(o)}),(o,s)=>(n(),a("div",fe,[e("header",ve,[s[10]||(s[10]=e("h1",{class:"page-title"},"Inventario",-1)),e("div",ye,[e("button",{class:"btn btn-success",onClick:s[0]||(s[0]=t=>C("ingreso"))},[h(_,{name:"download",size:16}),s[8]||(s[8]=j(" Registrar ingreso ",-1))]),e("button",{class:"btn btn-danger",onClick:s[1]||(s[1]=t=>C("egreso"))},[h(_,{name:"upload",size:16}),s[9]||(s[9]=j(" Registrar egreso ",-1))])])]),e("div",be,[e("table",he,[s[12]||(s[12]=e("thead",null,[e("tr",null,[e("th",null,"Fecha"),e("th",null,"Tipo"),e("th",null,"Producto"),e("th",null,"Cantidad"),e("th",null,"Motivo"),e("th",null,"Estado"),e("th",null,"Notas"),e("th",null,"Acciones")])],-1)),e("tbody",null,[k.value.length===0?(n(),a("tr",_e,[...s[11]||(s[11]=[e("td",{colspan:"8",class:"empty-cell"}," No hay movimientos registrados ",-1)])])):p("",!0),(n(!0),a($,null,x(k.value,t=>{var u,I,M,q;return n(),a("tr",{key:t.id},[e("td",ke,r(i(t.date)),1),e("td",null,[e("span",{class:v(["type-badge",t.type==="ingreso"?"badge-success":"badge-danger"])},r(t.type==="ingreso"?"Ingreso":"Egreso"),3)]),e("td",null,[e("div",Ce,[(u=t.product)!=null&&u.image?(n(),a("img",{key:0,src:t.product.image,alt:(I=t.product)==null?void 0:I.name,class:"product-thumb"},null,8,Ve)):p("",!0),e("div",$e,[e("span",xe,r(((M=t.product)==null?void 0:M.name)||"Producto eliminado"),1),e("span",we,r((q=t.product)==null?void 0:q.brand),1)])])]),e("td",Ie,[e("span",{class:v(t.type==="ingreso"?"text-success":"text-danger")},r(t.type==="ingreso"?"+":"-")+r(t.quantity),3)]),e("td",null,r(t.reason),1),e("td",null,[e("span",{class:v(["type-badge",l(t.status).class])},r(l(t.status).text),3)]),e("td",Me,r(t.notes||"-"),1),e("td",Se,[e("div",Te,[t.type==="egreso"&&t.status==="pendiente"?(n(),a("button",{key:0,class:"btn btn-sm btn-warning",onClick:R=>O(t.id),title:"Confirmar transferencia"}," Confirmar transferencia ",8,qe)):p("",!0),t.type==="egreso"&&t.status==="confirmado"?(n(),a("button",{key:1,class:"btn btn-sm btn-info",onClick:R=>d(t.id),title:"Confirmar entrega"}," Confirmar entrega ",8,ze)):p("",!0),t.status==="completado"||t.type==="ingreso"?(n(),a("button",{key:2,class:"btn-icon",onClick:R=>P(t.id),title:"Eliminar"},[h(_,{name:"trash",size:16})],8,Be)):p("",!0)])])])}),128))])])]),(n(),D(H,{to:"body"},[b.value?(n(),a("div",{key:0,class:"modal-overlay",onClick:L(w,["self"])},[e("div",Ee,[e("header",Pe,[e("h2",Oe,[h(_,{name:m.value==="ingreso"?"download":"upload",size:20},null,8,["name"]),j(" "+r(m.value==="ingreso"?"Registrar ingreso":"Registrar egreso"),1)]),e("button",{class:"modal-close",onClick:w},"×")]),e("form",{class:"modal-body",onSubmit:s[7]||(s[7]=L((...t)=>o.submitMovement&&o.submitMovement(...t),["prevent"]))},[e("div",je,[s[14]||(s[14]=e("label",{class:"form-label"},"Producto *",-1)),m.value==="ingreso"?(n(),D(ge,{key:0,modelValue:g.value.productIds,"onUpdate:modelValue":s[2]||(s[2]=t=>g.value.productIds=t),multiple:!0},null,8,["modelValue"])):S((n(),a("select",{key:1,"onUpdate:modelValue":s[3]||(s[3]=t=>g.value.productId=t),class:v(["form-select",{"form-input--error":c.value.productId}])},[s[13]||(s[13]=e("option",{value:""},"Seleccionar producto",-1)),(n(!0),a($,null,x(E.value,t=>(n(),a("option",{key:t.id,value:t.id},r(t.name)+" - Stock: "+r(t.stock),9,Ae))),128))],2)),[[U,g.value.productId]]),c.value.productId?(n(),a("span",Re,r(c.value.productId),1)):p("",!0),c.value.productIds?(n(),a("span",De,r(c.value.productIds),1)):p("",!0)]),e("div",Le,[s[15]||(s[15]=e("label",{class:"form-label"},"Cantidad *",-1)),S(e("input",{type:"number","onUpdate:modelValue":s[4]||(s[4]=t=>g.value.quantity=t),min:"1",class:v(["form-input",{"form-input--error":c.value.quantity}])},null,2),[[A,g.value.quantity,void 0,{number:!0}]]),c.value.quantity?(n(),a("span",Ue,r(c.value.quantity),1)):p("",!0)]),e("div",Ne,[s[16]||(s[16]=e("label",{class:"form-label"},"Motivo *",-1)),S(e("select",{"onUpdate:modelValue":s[5]||(s[5]=t=>g.value.reason=t),class:v(["form-select",{"form-input--error":c.value.reason}])},[(n(!0),a($,null,x(T[m.value],t=>(n(),a("option",{key:t,value:t},r(t),9,Fe))),128))],2),[[U,g.value.reason]]),c.value.reason?(n(),a("span",We,r(c.value.reason),1)):p("",!0)]),e("div",Qe,[s[17]||(s[17]=e("label",{class:"form-label"},"Notas",-1)),S(e("textarea",{"onUpdate:modelValue":s[6]||(s[6]=t=>g.value.notes=t),class:"form-textarea",rows:"2"},null,512),[[A,g.value.notes]])]),e("div",Ge,[e("button",{type:"button",class:"btn btn-secondary",onClick:w}," Cancelar "),e("button",{type:"submit",class:v(["btn",m.value==="ingreso"?"btn-success":"btn-danger"])},r(m.value==="ingreso"?"Registrar ingreso":"Registrar egreso"),3)])],32)])])):p("",!0)]))]))}},Ye=N(He,[["__scopeId","data-v-ed7001da"]]);export{Ye as default};
