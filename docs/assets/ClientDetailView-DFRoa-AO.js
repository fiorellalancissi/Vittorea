import{_ as H,g as y,j as J,i as z,m as K,c as n,k as p,b as e,f as Q,a as r,p as _,t as a,F as q,r as D,e as B,q as b,s as N,A as O,D as W,v as X,T as Y,o,n as P}from"./index-BRhBE-Hd.js";import{u as Z}from"./admin-CNJvRZFe.js";import{_ as c}from"./Icon-BQh9hsRm.js";const ee={key:0,class:"client-detail-page"},te={class:"page-header"},se={class:"client-info-card"},ae={class:"client-avatar-large"},ie={class:"client-main-info"},oe={class:"client-name-large"},ne={class:"client-contact"},le={class:"contact-item"},de={key:0,class:"contact-item"},re={class:"contact-item"},ce={key:0,class:"client-tags"},ue={key:1,class:"client-notes"},ve={class:"client-stats-grid"},pe={class:"stat-box"},me={class:"stat-value"},_e={class:"stat-box"},be={class:"stat-value"},fe={class:"stat-box"},ge={class:"stat-value"},ke={class:"stat-box"},ye={class:"stat-value"},he={class:"content-grid"},Ce={class:"section-card"},Ie={class:"section-title"},Ve={key:0,class:"empty-section"},xe={key:1,class:"orders-list"},ze={class:"order-header"},we={class:"order-info"},Fe={class:"order-id"},Se={class:"order-date"},qe={class:"order-product"},De=["src","alt"],Ne={class:"product-details"},Me={class:"product-name"},Ae={class:"product-quantity"},Be={class:"order-total"},Oe={class:"order-actions"},Pe=["onClick"],Re={class:"section-card"},Ue={class:"section-title"},Te={key:0,class:"empty-section"},je={key:1,class:"feedbacks-list"},Ee={class:"feedback-header"},$e={class:"feedback-product"},Le={class:"product-name"},Ge={class:"feedback-date"},He=["onClick"],Je={class:"feedback-metrics"},Ke={class:"metric-pill"},Qe={class:"metric-pill"},We={key:0,class:"metric-pill metric-positive"},Xe={key:0,class:"feedback-comment"},Ye={class:"modal"},Ze={class:"modal-header"},et={class:"modal-title"},tt={class:"feedback-order-info"},st={class:"form-group"},at={class:"radio-group"},it={class:"radio-label"},ot={class:"radio-label"},nt={class:"radio-label"},lt={class:"form-row"},dt={class:"form-group"},rt={class:"form-group"},ct={class:"form-group"},ut={class:"checkbox-label"},vt={class:"form-group"},pt={__name:"ClientDetailView",setup(mt){const R=J(),M=K(),f=Z(),h=y(()=>Number(R.params.id)),u=y(()=>f.getClientById(h.value)),g=y(()=>f.getOrdersByClient(h.value)),A=y(()=>f.getFeedbacksByClient(h.value)),w=z(!1),k=z(null),i=z({productId:"",nivel_satisfaccion:"positivo",duracion_percibida:"media",intensidad_percibida:"media",volveria_a_comprar:!0,comentario_libre:""}),U=z({}),C=y(()=>{const l=g.value.reduce((d,m)=>d+m.total,0),t=g.value.length,V=t>0?l/t:0,v={};g.value.forEach(d=>{v[d.productId]||(v[d.productId]={product:d.product,quantity:0}),v[d.productId].quantity+=d.quantity});const x=Object.keys(v).length,s=Object.values(v).sort((d,m)=>m.quantity-d.quantity)[0];return{totalSpent:l,totalOrders:t,avgOrderValue:V,uniqueProducts:x,topProduct:s==null?void 0:s.product}});function T(l){k.value=l,i.value={productId:l.productId,nivel_satisfaccion:"positivo",duracion_percibida:"media",intensidad_percibida:"media",volveria_a_comprar:!0,comentario_libre:""},U.value={},w.value=!0}function I(){w.value=!1,k.value=null}function j(){f.addFeedback({clientId:h.value,orderId:k.value.id,productId:i.value.productId,nivel_satisfaccion:i.value.nivel_satisfaccion,duracion_percibida:i.value.duracion_percibida,intensidad_percibida:i.value.intensidad_percibida,volveria_a_comprar:i.value.volveria_a_comprar,comentario_libre:i.value.comentario_libre}),I()}function E(l){confirm("¿Eliminar este feedback?")&&f.deleteFeedback(l)}function $(l){switch(l){case"positivo":return"satisfaction-positive";case"neutro":return"satisfaction-neutral";case"negativo":return"satisfaction-negative";default:return""}}function L(l){switch(l){case"positivo":return"check";case"neutro":return"arrow-right";case"negativo":return"alert";default:return"arrow-right"}}function F(l){return new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:0}).format(l)}function S(l){return new Date(l).toLocaleDateString("es-AR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}function G(){M.push("/admin/clientes")}return u.value||M.push("/admin/clientes"),(l,t)=>{var V,v,x;return u.value?(o(),n("div",ee,[e("div",te,[e("button",{class:"btn-back",onClick:G},[r(c,{name:"arrow-right",size:16,style:{transform:"rotate(180deg)"}}),t[7]||(t[7]=_(" Volver ",-1))])]),e("div",se,[e("div",ae,a(u.value.nombre.charAt(0).toUpperCase()),1),e("div",ie,[e("h1",oe,a(u.value.nombre),1),e("div",ne,[e("div",le,[r(c,{name:"box",size:16}),e("span",null,a(u.value.telefono),1)]),u.value.email?(o(),n("div",de,[r(c,{name:"settings",size:16}),e("span",null,a(u.value.email),1)])):p("",!0),e("div",re,[r(c,{name:"calendar",size:16}),e("span",null,"Última compra: "+a(S(u.value.fecha_ultima_compra)),1)])]),u.value.tags&&u.value.tags.length>0?(o(),n("div",ce,[(o(!0),n(q,null,D(u.value.tags,s=>(o(),n("span",{key:s,class:"tag"},a(s),1))),128))])):p("",!0),u.value.notas_internas?(o(),n("div",ue,[t[8]||(t[8]=e("strong",null,"Notas:",-1)),_(" "+a(u.value.notas_internas),1)])):p("",!0)]),e("div",ve,[e("div",pe,[r(c,{name:"box",size:24}),e("span",me,a(C.value.totalOrders),1),t[9]||(t[9]=e("span",{class:"stat-label"},"Pedidos",-1))]),e("div",_e,[r(c,{name:"money",size:24}),e("span",be,a(F(C.value.totalSpent)),1),t[10]||(t[10]=e("span",{class:"stat-label"},"Total gastado",-1))]),e("div",fe,[r(c,{name:"bottle",size:24}),e("span",ge,a(C.value.uniqueProducts),1),t[11]||(t[11]=e("span",{class:"stat-label"},"Productos únicos",-1))]),e("div",ke,[r(c,{name:"trending-up",size:24}),e("span",ye,a(F(C.value.avgOrderValue)),1),t[12]||(t[12]=e("span",{class:"stat-label"},"Ticket promedio",-1))])])]),e("div",he,[e("section",Ce,[e("h2",Ie,[r(c,{name:"package",size:20}),t[13]||(t[13]=_(" Historial de pedidos ",-1))]),g.value.length===0?(o(),n("div",Ve,[...t[14]||(t[14]=[e("p",null,"Este cliente aún no tiene pedidos registrados",-1)])])):(o(),n("div",xe,[(o(!0),n(q,null,D(g.value,s=>{var d,m;return o(),n("div",{key:s.id,class:"order-item"},[e("div",ze,[e("div",we,[e("span",Fe,"Pedido #"+a(s.id),1),e("span",Se,a(S(s.date)),1)]),e("span",{class:P(["order-status",`status-${s.estado}`])},a(s.estado),3)]),e("div",qe,[(d=s.product)!=null&&d.image?(o(),n("img",{key:0,src:s.product.image,alt:s.product.name,class:"product-img"},null,8,De)):p("",!0),e("div",Ne,[e("span",Me,a(((m=s.product)==null?void 0:m.name)||"Producto eliminado"),1),e("span",Ae,a(s.quantity)+" unidad"+a(s.quantity>1?"es":""),1)]),e("span",Be,a(F(s.total)),1)]),e("div",Oe,[e("button",{class:"btn btn-sm btn-outline",onClick:_t=>T(s)},[r(c,{name:"settings",size:14}),t[15]||(t[15]=_(" Agregar feedback ",-1))],8,Pe)])])}),128))]))]),e("section",Re,[e("h2",Ue,[r(c,{name:"chart",size:20}),t[16]||(t[16]=_(" Feedback y preferencias ",-1))]),A.value.length===0?(o(),n("div",Te,[...t[17]||(t[17]=[e("p",null,"No hay feedback registrado aún",-1),e("small",null,"Agregá feedback desde los pedidos para trackear preferencias",-1)])])):(o(),n("div",je,[(o(!0),n(q,null,D(A.value,s=>{var d;return o(),n("div",{key:s.id,class:"feedback-item"},[e("div",Ee,[e("div",$e,[e("span",Le,a((d=s.product)==null?void 0:d.name),1),e("span",Ge,a(S(s.fecha)),1)]),e("button",{class:"btn-icon",onClick:m=>E(s.id),title:"Eliminar"},[r(c,{name:"trash",size:14})],8,He)]),e("div",Je,[e("div",{class:P(["metric-badge",$(s.nivel_satisfaccion)])},[r(c,{name:L(s.nivel_satisfaccion),size:14},null,8,["name"]),_(" "+a(s.nivel_satisfaccion),1)],2),e("div",Ke," Duración: "+a(s.duracion_percibida),1),e("div",Qe," Intensidad: "+a(s.intensidad_percibida),1),s.volveria_a_comprar?(o(),n("div",We," Recompraría ")):p("",!0)]),s.comentario_libre?(o(),n("p",Xe,' "'+a(s.comentario_libre)+'" ',1)):p("",!0)])}),128))]))])]),(o(),Q(Y,{to:"body"},[w.value?(o(),n("div",{key:0,class:"modal-overlay",onClick:B(I,["self"])},[e("div",Ye,[e("header",Ze,[e("h2",et,[r(c,{name:"settings",size:20}),t[18]||(t[18]=_(" Registrar feedback ",-1))]),e("button",{class:"modal-close",onClick:I},"×")]),e("form",{class:"modal-body",onSubmit:B(j,["prevent"])},[e("div",tt,[e("strong",null,"Pedido #"+a((V=k.value)==null?void 0:V.id),1),e("span",null,a((x=(v=k.value)==null?void 0:v.product)==null?void 0:x.name),1)]),e("div",st,[t[22]||(t[22]=e("label",{class:"form-label"},"Nivel de satisfacción",-1)),e("div",at,[e("label",it,[b(e("input",{type:"radio","onUpdate:modelValue":t[0]||(t[0]=s=>i.value.nivel_satisfaccion=s),value:"positivo"},null,512),[[N,i.value.nivel_satisfaccion]]),t[19]||(t[19]=e("span",null,"Positivo",-1))]),e("label",ot,[b(e("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=s=>i.value.nivel_satisfaccion=s),value:"neutro"},null,512),[[N,i.value.nivel_satisfaccion]]),t[20]||(t[20]=e("span",null,"Neutro",-1))]),e("label",nt,[b(e("input",{type:"radio","onUpdate:modelValue":t[2]||(t[2]=s=>i.value.nivel_satisfaccion=s),value:"negativo"},null,512),[[N,i.value.nivel_satisfaccion]]),t[21]||(t[21]=e("span",null,"Negativo",-1))])])]),e("div",lt,[e("div",dt,[t[24]||(t[24]=e("label",{class:"form-label"},"Duración percibida",-1)),b(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>i.value.duracion_percibida=s),class:"form-select"},[...t[23]||(t[23]=[e("option",{value:"baja"},"Baja",-1),e("option",{value:"media"},"Media",-1),e("option",{value:"alta"},"Alta",-1)])],512),[[O,i.value.duracion_percibida]])]),e("div",rt,[t[26]||(t[26]=e("label",{class:"form-label"},"Intensidad percibida",-1)),b(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>i.value.intensidad_percibida=s),class:"form-select"},[...t[25]||(t[25]=[e("option",{value:"suave"},"Suave",-1),e("option",{value:"media"},"Media",-1),e("option",{value:"intensa"},"Intensa",-1)])],512),[[O,i.value.intensidad_percibida]])])]),e("div",ct,[e("label",ut,[b(e("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=s=>i.value.volveria_a_comprar=s)},null,512),[[W,i.value.volveria_a_comprar]]),t[27]||(t[27]=e("span",null,"Volvería a comprar este producto",-1))])]),e("div",vt,[t[28]||(t[28]=e("label",{class:"form-label"},"Comentario (opcional)",-1)),b(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=s=>i.value.comentario_libre=s),class:"form-textarea",rows:"3",placeholder:"Observaciones, preferencias, detalles..."},null,512),[[X,i.value.comentario_libre]])]),e("div",{class:"form-actions"},[e("button",{type:"button",class:"btn btn-outline",onClick:I}," Cancelar "),t[29]||(t[29]=e("button",{type:"submit",class:"btn btn-primary"}," Guardar feedback ",-1))])],32)])])):p("",!0)]))])):p("",!0)}}},kt=H(pt,[["__scopeId","data-v-6d0f1538"]]);export{kt as default};
