import{_ as ce,g as x,i as v,B as N,z as de,j as ve,c as i,b as t,f as me,a as C,p as $,k as d,F as B,r as E,e as b,t as r,q as k,v as y,n as P,C as T,T as pe,o}from"./index-BRhBE-Hd.js";import{u as fe}from"./admin-CNJvRZFe.js";import{_ as M}from"./Icon-BQh9hsRm.js";const ge={class:"products-page"},be={class:"page-header"},Pe={class:"table-container"},ke={class:"data-table"},ye={key:0},_e={colspan:"7",class:"empty-cell"},he={class:"product-cell"},we=["src","alt"],Se={class:"product-info"},Ce={class:"product-name"},Me={key:0,class:"product-description"},xe={class:"brand-badge"},$e={class:"cell-cost"},Ie={class:"cell-price"},De={class:"cell-margin"},Ve={class:"margin-badge"},Fe={class:"cell-actions"},Ne=["onClick"],Be=["onClick"],Ee={class:"modal modal--wide"},Le={class:"modal-header"},ze={class:"modal-title"},Oe={class:"form-row"},Te={class:"form-group"},Ue={key:0,class:"form-error"},Ae={class:"form-group"},Ke={class:"autocomplete-wrapper"},Re=["onKeydown"],Ge={key:0,class:"autocomplete-suggestions"},je=["onMousedown"],qe={key:0,class:"form-error"},We={class:"form-row"},Je={class:"form-group"},He={class:"autocomplete-wrapper"},Qe=["onKeydown"],Xe={key:0,class:"autocomplete-suggestions"},Ye=["onMousedown"],Ze={class:"form-group"},et={class:"autocomplete-wrapper"},tt=["onKeydown"],st={key:0,class:"autocomplete-suggestions"},lt=["onMousedown"],at={class:"price-section"},ot={class:"form-row"},nt={class:"form-group"},it={class:"input-with-prefix"},rt={key:0,class:"form-error"},ut={class:"form-group"},ct={class:"input-with-prefix"},dt=["disabled"],vt={key:0,class:"form-error"},mt={class:"price-mode-toggle"},pt={key:1,class:"form-hint"},ft={key:0,class:"price-preview"},gt={class:"preview-item"},bt={class:"preview-value profit-text"},Pt={class:"preview-item"},kt={class:"preview-value"},yt={class:"form-group"},_t={class:"form-label"},ht={key:0,class:"form-error"},wt={class:"form-group"},St={class:"form-group"},Ct={key:0,class:"upload-placeholder"},Mt={key:1,class:"upload-preview"},xt=["src","alt"],$t={class:"modal-actions"},It={type:"submit",class:"btn btn-primary"},Dt={__name:"ProductsView",setup(Vt){const q=ve(),c=fe(),U=x(()=>c.productsWithBrand),W=x(()=>c.brands.filter(a=>a.active)),J=x(()=>c.lines.filter(a=>a.active)),H=x(()=>c.mlOptions.filter(a=>a.active)),L=v(!1),m=v(null),s=v({name:"",brand:"",line:"",ml:"",costPrice:"",salePrice:"",customSalePrice:!1,description:"",image:"",stock:0}),_=v([]),h=v([]),w=v([]),p=v(!1),f=v(!1),g=v(!1),I=v(null),D=v(!1),n=v({}),A=x(()=>s.value.costPrice&&s.value.costPrice>0?c.calculateSalePrice(s.value.costPrice):0);N(()=>s.value.costPrice,a=>{!s.value.customSalePrice&&a>0&&(s.value.salePrice=c.calculateSalePrice(a))}),N(()=>s.value.brand,a=>{if(!a){_.value=[],p.value=!1;return}const e=W.value.filter(l=>l.name.toLowerCase().includes(a.toLowerCase()));_.value=e,p.value=e.length>0}),N(()=>s.value.line,a=>{if(!a){h.value=[],f.value=!1;return}const e=J.value.filter(l=>l.name.toLowerCase().includes(a.toLowerCase()));h.value=e,f.value=e.length>0}),N(()=>s.value.ml,a=>{if(!a){w.value=[],g.value=!1;return}const e=H.value.filter(l=>l.value.toString().includes(a));w.value=e,g.value=e.length>0});function V(a=null){m.value=a,a?s.value={name:a.name,brand:a.brand||"",line:a.line||"",ml:a.ml||"",costPrice:a.costPrice,salePrice:a.salePrice,customSalePrice:a.salePrice!==c.calculateSalePrice(a.costPrice),description:a.description||"",image:a.image||"",stock:a.stock}:s.value={name:"",brand:"",line:"",ml:"",costPrice:"",salePrice:"",customSalePrice:!1,description:"",image:"",stock:0},n.value={},L.value=!0}function F(){L.value=!1,m.value=null,p.value=!1,f.value=!1,g.value=!1}function K(a){s.value.brand=a.name,p.value=!1}function R(a){s.value.line=a.name,f.value=!1}function G(a){s.value.ml=a.value,g.value=!1}function Q(){s.value.brand&&_.value.length===0?p.value=!1:_.value.length>0&&K(_.value[0])}function X(){s.value.line&&h.value.length===0?f.value=!1:h.value.length>0&&R(h.value[0])}function Y(){s.value.ml&&w.value.length===0?g.value=!1:w.value.length>0&&G(w.value[0])}function Z(){s.value.customSalePrice=!s.value.customSalePrice,s.value.customSalePrice||(s.value.salePrice=A.value)}function ee(){return n.value={},s.value.name.trim()||(n.value.name="El nombre es obligatorio"),s.value.brand.trim()||(n.value.brand="La marca es obligatoria"),(!s.value.costPrice||s.value.costPrice<=0)&&(n.value.costPrice="El precio de costo debe ser mayor a 0"),(!s.value.salePrice||s.value.salePrice<=0)&&(n.value.salePrice="El precio de venta debe ser mayor a 0"),s.value.salePrice&&s.value.costPrice&&s.value.salePrice<=s.value.costPrice&&(n.value.salePrice="El precio de venta debe ser mayor al costo"),s.value.stock<0&&(n.value.stock="El stock no puede ser negativo"),Object.keys(n.value).length===0}function te(){if(!ee())return;const a=c.findOrCreateBrand(s.value.brand),e=s.value.line?c.findOrCreateLine(s.value.line):null,l=s.value.ml?c.findOrCreateMl(s.value.ml):null,u={name:s.value.name,brandId:Number(a),lineId:e?Number(e):null,mlId:l?Number(l):null,costPrice:Number(s.value.costPrice),salePrice:Number(s.value.salePrice),description:s.value.description,image:s.value.image||"https://images.unsplash.com/photo-1541643600914-78b084683601?w=400&h=400&fit=crop"};if(m.value){if(c.updateProduct(m.value.id,u),m.value.stock!==s.value.stock){const S=s.value.stock-m.value.stock;c.addMovement({productId:m.value.id,type:S>0?"ingreso":"egreso",quantity:Math.abs(S),reason:"Ajuste de inventario",notes:"Ajuste desde edición de producto"})}}else{const S=c.addProduct(u);s.value.stock>0&&c.addMovement({productId:S.id,type:"ingreso",quantity:s.value.stock,reason:"Compra de stock",notes:"Stock inicial al crear producto"})}F()}function se(a){confirm("¿Eliminar este producto? También se eliminarán sus movimientos de inventario.")&&c.deleteProduct(a)}function le(a){var l;const e=(l=a.target.files)==null?void 0:l[0];e&&z(e)}function ae(a){var l;const e=(l=a.clipboardData)==null?void 0:l.items;if(e){for(let u=0;u<e.length;u++)if(e[u].type.indexOf("image")!==-1){const S=e[u].getAsFile();S&&(a.preventDefault(),z(S));break}}}function oe(a){a.preventDefault(),D.value=!0}function ne(){D.value=!1}function ie(a){var l,u;a.preventDefault(),D.value=!1;const e=(u=(l=a.dataTransfer)==null?void 0:l.files)==null?void 0:u[0];e&&e.type.indexOf("image")!==-1&&z(e)}function z(a){if(!a.type.startsWith("image/")){alert("Por favor seleccioná una imagen válida");return}const e=new FileReader;e.onload=l=>{s.value.image=l.target.result},e.readAsDataURL(a)}function re(){s.value.image="",I.value&&(I.value.value="")}function O(a){return new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:0}).format(a)}function ue(a){return a===0?"stock-empty":a<=3?"stock-low":"stock-ok"}function j(a,e){return!a||!e?0:((e-a)/a*100).toFixed(0)}return de(()=>{q.query.action==="nuevo"&&V()}),(a,e)=>(o(),i("div",ge,[t("header",be,[e[22]||(e[22]=t("h1",{class:"page-title"},"Productos",-1)),t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=l=>V())},[C(M,{name:"plus",size:16}),e[21]||(e[21]=$(" Nuevo producto ",-1))])]),t("div",Pe,[t("table",ke,[e[24]||(e[24]=t("thead",null,[t("tr",null,[t("th",null,"Producto"),t("th",null,"Marca"),t("th",null,"Costo"),t("th",null,"Venta"),t("th",null,"Margen"),t("th",null,"Stock"),t("th")])],-1)),t("tbody",null,[U.value.length===0?(o(),i("tr",ye,[t("td",_e,[e[23]||(e[23]=t("p",null,"No hay productos registrados",-1)),t("button",{class:"btn btn-primary btn-sm",onClick:e[1]||(e[1]=l=>V())}," Crear primer producto ")])])):d("",!0),(o(!0),i(B,null,E(U.value,l=>(o(),i("tr",{key:l.id},[t("td",null,[t("div",he,[t("img",{src:l.image,alt:l.name,class:"product-thumb"},null,8,we),t("div",Se,[t("span",Ce,r(l.name),1),l.description?(o(),i("span",Me,r(l.description.substring(0,40))+r(l.description.length>40?"...":""),1)):d("",!0)])])]),t("td",null,[t("span",xe,r(l.brand),1)]),t("td",$e,r(O(l.costPrice)),1),t("td",Ie,r(O(l.salePrice)),1),t("td",De,[t("span",Ve,"+"+r(j(l.costPrice,l.salePrice))+"%",1)]),t("td",null,[t("span",{class:P(["stock-badge",ue(l.stock)])},r(l.stock===0?"Sin stock":`${l.stock} uds`),3)]),t("td",Fe,[t("button",{class:"btn-icon",onClick:u=>V(l),title:"Editar"},[C(M,{name:"edit",size:16})],8,Ne),t("button",{class:"btn-icon",onClick:u=>se(l.id),title:"Eliminar"},[C(M,{name:"trash",size:16})],8,Be)])]))),128))])])]),(o(),me(pe,{to:"body"},[L.value?(o(),i("div",{key:0,class:"modal-overlay",onClick:b(F,["self"])},[t("div",Ee,[t("header",Le,[t("h2",ze,[C(M,{name:m.value?"edit":"bottle",size:20},null,8,["name"]),$(" "+r(m.value?"Editar producto":"Nuevo producto"),1)]),t("button",{class:"modal-close",onClick:F},"×")]),t("form",{class:"modal-body",onSubmit:b(te,["prevent"])},[t("div",Oe,[t("div",Te,[e[25]||(e[25]=t("label",{class:"form-label"},"Modelo *",-1)),k(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=l=>s.value.name=l),class:P(["form-input",{"form-input--error":n.value.name}])},null,2),[[y,s.value.name]]),n.value.name?(o(),i("span",Ue,r(n.value.name),1)):d("",!0)]),t("div",Ae,[e[26]||(e[26]=t("label",{class:"form-label"},"Marca *",-1)),t("div",Ke,[k(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=l=>s.value.brand=l),class:P(["form-input",{"form-input--error":n.value.brand}]),onInput:e[4]||(e[4]=l=>p.value=s.value.brand.length>0),onKeydown:T(b(Q,["prevent"]),["enter"]),onFocus:e[5]||(e[5]=l=>p.value=s.value.brand&&_.value.length>0),onBlur:e[6]||(e[6]=l=>a.setTimeout(()=>p.value=!1,200))},null,42,Re),[[y,s.value.brand]]),p.value?(o(),i("div",Ge,[(o(!0),i(B,null,E(_.value,l=>(o(),i("div",{key:l.id,class:"suggestion-item",onMousedown:b(u=>K(l),["prevent"])},r(l.name),41,je))),128))])):d("",!0)]),n.value.brand?(o(),i("span",qe,r(n.value.brand),1)):d("",!0)])]),t("div",We,[t("div",Je,[e[27]||(e[27]=t("label",{class:"form-label"},"Línea",-1)),t("div",He,[k(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=l=>s.value.line=l),class:"form-input",onInput:e[8]||(e[8]=l=>f.value=s.value.line.length>0),onKeydown:T(b(X,["prevent"]),["enter"]),onFocus:e[9]||(e[9]=l=>f.value=s.value.line&&h.value.length>0),onBlur:e[10]||(e[10]=l=>a.setTimeout(()=>f.value=!1,200))},null,40,Qe),[[y,s.value.line]]),f.value?(o(),i("div",Xe,[(o(!0),i(B,null,E(h.value,l=>(o(),i("div",{key:l.id,class:"suggestion-item",onMousedown:b(u=>R(l),["prevent"])},r(l.name),41,Ye))),128))])):d("",!0)])]),t("div",Ze,[e[28]||(e[28]=t("label",{class:"form-label"},"Volumen",-1)),t("div",et,[k(t("input",{type:"text","onUpdate:modelValue":e[11]||(e[11]=l=>s.value.ml=l),class:"form-input",onInput:e[12]||(e[12]=l=>g.value=s.value.ml.length>0),onKeydown:T(b(Y,["prevent"]),["enter"]),onFocus:e[13]||(e[13]=l=>g.value=s.value.ml&&w.value.length>0),onBlur:e[14]||(e[14]=l=>a.setTimeout(()=>g.value=!1,200))},null,40,tt),[[y,s.value.ml]]),g.value?(o(),i("div",st,[(o(!0),i(B,null,E(w.value,l=>(o(),i("div",{key:l.id,class:"suggestion-item",onMousedown:b(u=>G(l),["prevent"])},r(l.value),41,lt))),128))])):d("",!0)])])]),t("div",at,[e[35]||(e[35]=t("h3",{class:"price-section-title"},"Precios",-1)),t("div",ot,[t("div",nt,[e[30]||(e[30]=t("label",{class:"form-label"},"Precio de costo *",-1)),t("div",it,[e[29]||(e[29]=t("span",{class:"input-prefix"},"$",-1)),k(t("input",{type:"number","onUpdate:modelValue":e[15]||(e[15]=l=>s.value.costPrice=l),class:P(["form-input form-input--prefixed",{"form-input--error":n.value.costPrice}]),min:"0",step:"100"},null,2),[[y,s.value.costPrice,void 0,{number:!0}]])]),n.value.costPrice?(o(),i("span",rt,r(n.value.costPrice),1)):d("",!0)]),t("div",ut,[e[32]||(e[32]=t("label",{class:"form-label"}," Precio de venta * ",-1)),t("div",ct,[e[31]||(e[31]=t("span",{class:"input-prefix"},"$",-1)),k(t("input",{type:"number","onUpdate:modelValue":e[16]||(e[16]=l=>s.value.salePrice=l),class:P(["form-input form-input--prefixed",{"form-input--error":n.value.salePrice}]),disabled:!s.value.customSalePrice,min:"0",step:"100"},null,10,dt),[[y,s.value.salePrice,void 0,{number:!0}]])]),n.value.salePrice?(o(),i("span",vt,r(n.value.salePrice),1)):d("",!0),t("div",mt,[t("button",{type:"button",class:P(["toggle-option",{active:!s.value.customSalePrice}]),onClick:e[17]||(e[17]=l=>{s.value.customSalePrice=!1,s.value.salePrice=A.value})}," Auto ",2),t("button",{type:"button",class:P(["toggle-option",{active:s.value.customSalePrice}]),onClick:Z}," Manual ",2)]),s.value.customSalePrice?d("",!0):(o(),i("p",pt," +40% sobre el costo "))])]),s.value.costPrice&&s.value.salePrice?(o(),i("div",ft,[t("div",gt,[e[33]||(e[33]=t("span",{class:"preview-label"},"Ganancia por unidad",-1)),t("span",bt,r(O(s.value.salePrice-s.value.costPrice)),1)]),t("div",Pt,[e[34]||(e[34]=t("span",{class:"preview-label"},"Margen",-1)),t("span",kt,r(j(s.value.costPrice,s.value.salePrice))+"%",1)])])):d("",!0)]),t("div",yt,[t("label",_t,r(m.value?"Stock actual":"Stock inicial"),1),k(t("input",{type:"number","onUpdate:modelValue":e[18]||(e[18]=l=>s.value.stock=l),class:P(["form-input",{"form-input--error":n.value.stock}]),min:"0",style:{"max-width":"150px"}},null,2),[[y,s.value.stock,void 0,{number:!0}]]),n.value.stock?(o(),i("span",ht,r(n.value.stock),1)):d("",!0)]),t("div",wt,[e[36]||(e[36]=t("label",{class:"form-label"},"Descripción",-1)),k(t("textarea",{"onUpdate:modelValue":e[19]||(e[19]=l=>s.value.description=l),class:"form-textarea",rows:"3"},null,512),[[y,s.value.description]])]),t("div",St,[e[39]||(e[39]=t("label",{class:"form-label"},"Imagen del producto",-1)),t("div",{class:P(["image-upload-zone",{dragging:D.value}]),onClick:e[20]||(e[20]=l=>{var u;return(u=I.value)==null?void 0:u.click()}),onPaste:ae,onDragover:oe,onDragleave:ne,onDrop:ie,tabindex:"0"},[t("input",{ref_key:"imageInputRef",ref:I,type:"file",accept:"image/*",onChange:le,style:{display:"none"}},null,544),s.value.image?(o(),i("div",Mt,[t("img",{src:s.value.image,alt:s.value.name||"Preview",class:"preview-image"},null,8,xt),t("button",{type:"button",class:"remove-image-btn",onClick:b(re,["stop"])},[C(M,{name:"trash",size:16})])])):(o(),i("div",Ct,[C(M,{name:"download",size:32}),e[37]||(e[37]=t("p",{class:"upload-text"},[t("strong",null,"Click"),$(", "),t("strong",null,"arrastrá"),$(" o "),t("strong",null,"pegá"),$(" (Ctrl+V) una imagen ")],-1)),e[38]||(e[38]=t("p",{class:"upload-hint"},"PNG, JPG o GIF",-1))]))],34)]),t("div",$t,[t("button",{type:"button",class:"btn btn-secondary",onClick:F}," Cancelar "),t("button",It,r(m.value?"Guardar cambios":"Crear producto"),1)])],32)])])):d("",!0)]))]))}},Et=ce(Dt,[["__scopeId","data-v-127f60ed"]]);export{Et as default};
