import{_ as K,g as T,i as _,c as n,b as e,f as P,t as i,a as d,p as V,q as g,v as h,k as c,F as $,r as z,e as k,n as A,C as j,T as G,m as Q,o as a}from"./index-CNK69vUn.js";import{u as H}from"./admin-DZLQbXIy.js";import{_ as m}from"./Icon-BjZeGox9.js";const J={class:"clients-page"},W={class:"page-header"},X={class:"header-left"},Y={class:"page-subtitle"},Z={class:"search-bar"},ee={class:"clients-grid"},te={key:0,class:"empty-state"},se={key:0},oe={key:1},le=["onClick"],ae={class:"client-header"},ne={class:"client-avatar"},ie={class:"client-info"},re={class:"client-name"},ue={class:"client-phone"},de={key:0,class:"client-email"},ce={key:0,class:"client-tags"},me={class:"client-stats"},ve={class:"stat"},pe={class:"stat"},fe={class:"stat stat-highlight"},be=["onClick"],_e=["onClick","disabled"],ge={class:"modal"},he={class:"modal-header"},ye={class:"modal-title"},Ce={class:"form-group"},ke={key:0,class:"form-error"},we={class:"form-group"},xe={key:0,class:"form-error"},Ne={class:"form-group"},Ve={class:"form-group"},$e={class:"tags-input"},ze={key:0,class:"tags-list"},Ee=["onClick"],Se={class:"tag-add-row"},Te=["onKeydown"],Ae={class:"form-group"},Be={class:"form-actions"},Ue={type:"submit",class:"btn btn-primary"},De={__name:"ClientsView",setup(Fe){const B=Q(),b=H(),E=T(()=>b.clients),v=_(""),w=_(!1),p=_(null),o=_({nombre:"",telefono:"",email:"",notas_internas:"",tags:[]}),f=_(""),r=_({}),y=T(()=>{if(!v.value.trim())return E.value;const l=v.value.toLowerCase();return E.value.filter(t=>t.nombre.toLowerCase().includes(l)||t.telefono.includes(l)||t.email&&t.email.toLowerCase().includes(l))});function x(l){const t=b.getOrdersByClient(l),s=t.reduce((q,I)=>q+I.total,0),u=t.length;return{totalSpent:s,totalOrders:u}}function N(l=null){p.value=l,l?o.value={nombre:l.nombre,telefono:l.telefono,email:l.email||"",notas_internas:l.notas_internas||"",tags:[...l.tags||[]]}:o.value={nombre:"",telefono:"",email:"",notas_internas:"",tags:[]},r.value={},w.value=!0}function C(){w.value=!1,p.value=null,f.value=""}function S(){f.value.trim()&&!o.value.tags.includes(f.value.trim())&&(o.value.tags.push(f.value.trim()),f.value="")}function U(l){o.value.tags=o.value.tags.filter(t=>t!==l)}function D(){return r.value={},o.value.nombre.trim()||(r.value.nombre="El nombre es obligatorio"),o.value.telefono.trim()?/^\d{10}$/.test(o.value.telefono.replace(/\s/g,""))||(r.value.telefono="Ingresá un teléfono válido (10 dígitos)"):r.value.telefono="El teléfono es obligatorio",Object.keys(r.value).length===0}function F(){D()&&(p.value?b.updateClient(p.value.id,{nombre:o.value.nombre,telefono:o.value.telefono,email:o.value.email,notas_internas:o.value.notas_internas,tags:o.value.tags}):b.addClient({nombre:o.value.nombre,telefono:o.value.telefono,email:o.value.email,notas_internas:o.value.notas_internas,tags:o.value.tags}),C())}function O(l){const t=b.getOrdersByClient(l);if(t.length>0){alert(`No se puede eliminar este cliente porque tiene ${t.length} pedido(s) asociado(s).`);return}confirm("¿Eliminar este cliente?")&&b.deleteClient(l)}function L(l){B.push(`/admin/clientes/${l}`)}function M(l){return new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:0}).format(l)}function R(l){return l?new Date(l).toLocaleDateString("es-AR",{day:"2-digit",month:"2-digit",year:"numeric"}):"Sin compras"}return(l,t)=>(a(),n("div",J,[e("header",W,[e("div",X,[t[9]||(t[9]=e("h1",{class:"page-title"},"Clientes",-1)),e("p",Y,i(y.value.length)+" cliente"+i(y.value.length!==1?"s":""),1)]),e("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=s=>N())},[d(m,{name:"plus",size:16}),t[10]||(t[10]=V(" Nuevo cliente ",-1))])]),e("div",Z,[d(m,{name:"box",size:18,class:"search-icon"}),g(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=s=>v.value=s),placeholder:"Buscar por nombre o teléfono...",class:"search-input"},null,512),[[h,v.value]])]),e("div",ee,[y.value.length===0?(a(),n("div",te,[v.value?(a(),n("p",se,'No se encontraron clientes con "'+i(v.value)+'"',1)):(a(),n("p",oe,"No hay clientes registrados")),v.value?c("",!0):(a(),n("button",{key:2,class:"btn btn-primary",onClick:t[2]||(t[2]=s=>N())}," Crear primer cliente "))])):c("",!0),(a(!0),n($,null,z(y.value,s=>(a(),n("div",{key:s.id,class:"client-card",onClick:u=>L(s.id)},[e("div",ae,[e("div",ne,i(s.nombre.charAt(0).toUpperCase()),1),e("div",ie,[e("h3",re,i(s.nombre),1),e("p",ue,i(s.telefono),1),s.email?(a(),n("p",de,i(s.email),1)):c("",!0)])]),s.tags&&s.tags.length>0?(a(),n("div",ce,[(a(!0),n($,null,z(s.tags,u=>(a(),n("span",{key:u,class:"tag"},i(u),1))),128))])):c("",!0),e("div",me,[e("div",ve,[d(m,{name:"calendar",size:14}),e("span",null,i(R(s.fecha_ultima_compra)),1)]),e("div",pe,[d(m,{name:"box",size:14}),e("span",null,i(x(s.id).totalOrders)+" pedidos",1)]),e("div",fe,[d(m,{name:"money",size:14}),e("span",null,i(M(x(s.id).totalSpent)),1)])]),e("div",{class:"client-actions",onClick:t[3]||(t[3]=k(()=>{},["stop"]))},[e("button",{class:"btn-icon",onClick:u=>N(s),title:"Editar"},[d(m,{name:"edit",size:16})],8,be),e("button",{class:"btn-icon",onClick:u=>O(s.id),title:"Eliminar",disabled:x(s.id).totalOrders>0},[d(m,{name:"trash",size:16})],8,_e)])],8,le))),128))]),(a(),P(G,{to:"body"},[w.value?(a(),n("div",{key:0,class:"modal-overlay",onClick:k(C,["self"])},[e("div",ge,[e("header",he,[e("h2",ye,[d(m,{name:p.value?"edit":"plus",size:20},null,8,["name"]),V(" "+i(p.value?"Editar cliente":"Nuevo cliente"),1)]),e("button",{class:"modal-close",onClick:C},"×")]),e("form",{class:"modal-body",onSubmit:k(F,["prevent"])},[e("div",Ce,[t[11]||(t[11]=e("label",{class:"form-label"},"Nombre *",-1)),g(e("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=s=>o.value.nombre=s),class:A(["form-input",{"form-input--error":r.value.nombre}]),placeholder:"Nombre completo"},null,2),[[h,o.value.nombre]]),r.value.nombre?(a(),n("span",ke,i(r.value.nombre),1)):c("",!0)]),e("div",we,[t[12]||(t[12]=e("label",{class:"form-label"},"Teléfono *",-1)),g(e("input",{type:"tel","onUpdate:modelValue":t[5]||(t[5]=s=>o.value.telefono=s),class:A(["form-input",{"form-input--error":r.value.telefono}]),placeholder:"1134567890"},null,2),[[h,o.value.telefono]]),r.value.telefono?(a(),n("span",xe,i(r.value.telefono),1)):c("",!0)]),e("div",Ne,[t[13]||(t[13]=e("label",{class:"form-label"},"Email (opcional)",-1)),g(e("input",{type:"email","onUpdate:modelValue":t[6]||(t[6]=s=>o.value.email=s),class:"form-input",placeholder:"cliente@example.com"},null,512),[[h,o.value.email]])]),e("div",Ve,[t[14]||(t[14]=e("label",{class:"form-label"},"Tags",-1)),e("div",$e,[o.value.tags.length>0?(a(),n("div",ze,[(a(!0),n($,null,z(o.value.tags,s=>(a(),n("span",{key:s,class:"tag tag-removable"},[V(i(s)+" ",1),e("button",{type:"button",onClick:u=>U(s),class:"tag-remove"},"×",8,Ee)]))),128))])):c("",!0),e("div",Se,[g(e("input",{type:"text","onUpdate:modelValue":t[7]||(t[7]=s=>f.value=s),onKeydown:j(k(S,["prevent"]),["enter"]),class:"form-input form-input-sm",placeholder:"dulce, intenso, recompra..."},null,40,Te),[[h,f.value]]),e("button",{type:"button",onClick:S,class:"btn btn-secondary btn-sm"}," Agregar ")])]),t[15]||(t[15]=e("small",{class:"form-hint"},"Presioná Enter o click en Agregar",-1))]),e("div",Ae,[t[16]||(t[16]=e("label",{class:"form-label"},"Notas internas (opcional)",-1)),g(e("textarea",{"onUpdate:modelValue":t[8]||(t[8]=s=>o.value.notas_internas=s),class:"form-textarea",rows:"3",placeholder:"Preferencias, observaciones, recordatorios..."},null,512),[[h,o.value.notas_internas]])]),e("div",Be,[e("button",{type:"button",class:"btn btn-outline",onClick:C}," Cancelar "),e("button",Ue,i(p.value?"Guardar cambios":"Crear cliente"),1)])],32)])])):c("",!0)]))]))}},Re=K(De,[["__scopeId","data-v-0b30df16"]]);export{Re as default};
